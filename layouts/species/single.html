{{ define "main" }}

{{ $cat_name := index .Params.categories 0 }}
{{ $cat := .GetPage ( printf "genus/%s" $cat_name ) }}
{{ $status := .GetPage ( printf "status/%s" .Params.status ) }}

<div class="container py-3" data-pagefind-body>

  <div class="species-header p-1 clearfix" data-pagefind-filter="status:{{ $status.Params.title }}">
    <h1>{{ .Title }}</h1>
  
    {{ partial "species-summary" . }}

    <h2>Examples</h2>
    <p>{{ .Params.examples }}</p>
  </div>

  <div class="species-factsheet container p-3 text-center">
    <div class="row">
      <div class="col-12 col-sm-4 text-dark bg-primary-subtle border border-primary-subtle p-1">
        <div class="d-flex justify-content-center align-items-center">
          <h3 data-pagefind-filter="genus:{{ $cat.Params.title }}">{{ $cat.Params.title }}</h3>
        </div>
        <div class="d-flex justify-content-center align-items-center">
        {{ $path := printf "images/genus/%s.png" $cat_name  }}
        {{ with resources.Get $path }}
          {{ with .Resize "x80" }}
            <a href="{{ $cat.RelPermalink }}" title="{{ $cat.Params.title }}">
              <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" alt="{{ $cat.Params.title }}">
            </a>
          {{ end }}
        {{ end }}
        </div>
        <div class="d-flex justify-content-center align-items-center">
          <h3>Added to list: {{ index .Params "year-added" }}</h3>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-6 col-sm-4 text-light bg-danger">
        Imminence {{ .Params.imminence }}
      </div>
      <div class="col-6 col-sm-4 text-light bg-dark">
        <div class="h-50">Significance {{ .Params.significance }}</div>
        <div class="h-50">Impact {{ .Params.impact }}</div>
      </div>
      <div class="col-6 col-sm-4 text-light bg-primary">
        Effort {{ .Params.effort }}
      </div>
    </div>

    <div class="row pt-3 gx-3">
      <div class="col-12 col-sm-6 pb-2" >
        {{ with index .Params "status-at-risk"}}
        <div class="p-3 text-dark bg-danger border border-danger rounded-3 h-100" style="--bs-bg-opacity: .1;">
          <div class="p-2 m-1 float-end">
            {{ page.Store.Set "imageSize" "100x" }}{{ partial "status-img" . }}
          </div>
          {{ $status := page.GetPage ( printf "status/%s" .status ) }}
        <h3 class="mt-2">{{ $status.Params.title }}</i> in the Presence of Aggravating Conditions</h3>
        <p>{{ .reasons }}</p>
        </div>
        {{ end }}
        </div>
      <div class="col-12 col-sm-6 pb-2">
        {{ with index .Params "status-in-care"}}
        <div class="p-3 text-dark bg-success border border-success rounded-3 h-100" style="--bs-bg-opacity: .1;">
          <div class="p-2 m-1 float-end">
          {{ page.Store.Set "imageSize" "100x" }}{{ partial "status-img" . }}
          </div>
          {{ $status := page.GetPage ( printf "status/%s" .status ) }}
        <h3 class="mt-2"><i>{{ $status.Params.title }}</i> in the Presence of Good Practice</h3>
        {{ .reasons }}
        </div>
        {{ end }}
        </div>
    </div>
  </div>
  
  <div class="species-content p-1">
    <h2>Discussion</h2>
    <details open class="m-2">
      <summary>{{ T "contents" }}</summary>
      {{ .TableOfContents }}
    </details>

    {{ .Content }}

    {{ with index (.Params.aliases) 0 }}
    <a class="btn btn-sm btn-secondary" target="_blank" href="https://www.dpconline.org{{ . }}">
      Click Here To Open The Current Live Page For This Entry On The DPC Website
    </a>
    {{ end }}

    <h2>Raw Metadata</h2>
    <pretty-json>
    {{ .Params | jsonify (dict "indent" "  ") }}
    </pretty-json>
  </div>

</div>

{{ end }}